# TrackPose Configuration Package - Environment Variables
# This file documents all environment variables used across the monorepo
# Copy this to .env in your service directory and fill in actual values

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
# Prisma uses DATABASE_URL to connect to MySQL
# Format: mysql://USER:PASSWORD@HOST:PORT/DATABASE

# Local development with Docker Compose:
DATABASE_URL="mysql://trackpose:trackpose_password@localhost:3306/trackpose"

# Render managed database (get from Render dashboard):
# DATABASE_URL="mysql://user:password@dpg-xxxxx.oregon-postgres.render.com:3306/trackpose_db"

# Alternative env var name (Prisma also accepts this):
PRISMA_DATABASE_URL="${DATABASE_URL}"

# ============================================================================
# JWT AUTHENTICATION
# ============================================================================
# Generate with: openssl rand -hex 32
JWT_SECRET="<REPLACE_WITH_RANDOM_64_CHAR_STRING>"
JWT_EXPIRES_IN="7d"
JWT_REFRESH_EXPIRES_IN="30d"
JWT_ALGORITHM="HS256"

# ============================================================================
# STRIPE PAYMENT CONFIGURATION
# ============================================================================
# Get from: https://dashboard.stripe.com/apikeys
STRIPE_SECRET_KEY="sk_test_51..."  # Use sk_live_... in production
STRIPE_PUBLISHABLE_KEY="pk_test_51..."  # Use pk_live_... in production

# Webhook secret from: https://dashboard.stripe.com/webhooks
STRIPE_WEBHOOK_SECRET="whsec_..."

# Price IDs (create in Stripe Dashboard under Products)
STRIPE_PRICE_TRIAL="price_..."
STRIPE_PRICE_STANDARD="price_..."
STRIPE_PRICE_PREMIUM="price_..."
STRIPE_PRICE_ENTERPRISE="price_..."

# ============================================================================
# OBJECT STORAGE (S3-compatible)
# ============================================================================
# AWS S3:
S3_BUCKET="trackpose-storage"
S3_REGION="us-east-1"
S3_ACCESS_KEY_ID="AKIA..."
S3_SECRET_ACCESS_KEY="..."
S3_ENDPOINT=""  # Leave empty for AWS S3

# OR Render Object Storage:
# S3_BUCKET="trackpose-storage"
# S3_REGION="us-east-1"
# S3_ACCESS_KEY_ID="<from Render Object Storage>"
# S3_SECRET_ACCESS_KEY="<from Render Object Storage>"
# S3_ENDPOINT="https://<region>.storage.render.com"

# Optional S3 configuration:
S3_FORCE_PATH_STYLE="false"  # Set to "true" for MinIO or compatible services
S3_SIGNATURE_VERSION="v4"

# ============================================================================
# EMAIL CONFIGURATION
# ============================================================================
# Option A: SendGrid (recommended)
SENDGRID_API_KEY="SG...."
EMAIL_FROM="noreply@trackpose.com"
EMAIL_FROM_NAME="TrackPose"

# Option B: SMTP (alternative)
# SMTP_HOST="smtp.gmail.com"
# SMTP_PORT="587"
# SMTP_SECURE="false"  # true for 465, false for other ports
# SMTP_USER="your-email@gmail.com"
# SMTP_PASSWORD="your-app-password"
# EMAIL_FROM="your-email@gmail.com"
# EMAIL_FROM_NAME="TrackPose"

# Email templates configuration:
EMAIL_TEMPLATE_DIR="./templates/emails"
EMAIL_VERIFICATION_TEMPLATE="verification.html"
EMAIL_PASSWORD_RESET_TEMPLATE="password-reset.html"
EMAIL_ACCESS_CODE_TEMPLATE="access-code.html"

# ============================================================================
# MICROSERVICES COMMUNICATION
# ============================================================================
# Backend service URL (for media service to callback)
BACKEND_URL="http://localhost:3000"  # Local dev
# BACKEND_URL="https://trackpose-backend.onrender.com"  # Production

# Media processing service URL (for backend to send processing jobs)
MEDIA_SERVICE_URL="http://localhost:8000"  # Local dev
# MEDIA_SERVICE_URL="https://trackpose-media.onrender.com"  # Production

# Secure callback secret (MUST be same for both backend and media service)
# Generate with: openssl rand -hex 16
CALLBACK_SECRET="<REPLACE_WITH_RANDOM_32_CHAR_STRING>"

# Processing mode: "local" for AI aggregator stub, "remote" for media service
PROCESSING_MODE="local"  # Use "remote" in production

# ============================================================================
# FRONTEND / MOBILE APP
# ============================================================================
FRONTEND_URL="http://localhost:3000"
# FRONTEND_URL="https://trackpose.com"  # Production

# Mobile deep linking:
APP_SCHEME="trackpose"
APP_HOST="app"
APP_LINK_PREFIX="trackpose://app"

# ============================================================================
# APPLICATION CONFIGURATION
# ============================================================================
NODE_ENV="development"  # "production" in deployed environments
PORT="3000"  # Backend port
BACKEND_PORT="3000"
MEDIA_PORT="8000"

# API versioning:
API_VERSION="v1"
API_PREFIX="/api/v1"

# ============================================================================
# SECURITY & FEATURES
# ============================================================================
# CORS configuration (comma-separated allowed origins)
CORS_ORIGINS="http://localhost:3000,http://localhost:8080,http://localhost:8081"
# CORS_ORIGINS="https://trackpose.com,https://app.trackpose.com"  # Production
CORS_CREDENTIALS="true"

# Session management:
SESSION_SECRET="<REPLACE_WITH_RANDOM_32_CHAR_STRING>"
SESSION_MAX_AGE="86400000"  # 24 hours in milliseconds

# Token expiry times (in seconds):
PASSWORD_RESET_EXPIRY="3600"  # 1 hour
EMAIL_VERIFICATION_EXPIRY="900"  # 15 minutes
ACCESS_CODE_EXPIRY="2592000"  # 30 days

# Feature flags:
ENABLE_SWAGGER="true"  # API documentation (disable in production)
ENABLE_RATE_LIMITING="false"  # Enable in production
ENABLE_REQUEST_LOGGING="true"
FEATURE_LIVE_MONITORING="true"
FEATURE_AI_INSIGHTS="true"
FEATURE_NOTIFICATIONS="true"
FEATURE_REPORTS="true"

# ============================================================================
# TRIAL LIMITS (Server-side enforcement)
# ============================================================================
TRIAL_MAX_PROFILES="1"
TRIAL_MAX_FACILITIES="1"
TRIAL_MAX_SESSIONS="1"  # One-time upload
TRIAL_MAX_STORAGE_MB="100"
TRIAL_DURATION_DAYS="14"

# Plan limits:
STANDARD_MAX_PROFILES="5"
STANDARD_MAX_FACILITIES="2"
STANDARD_MAX_SESSIONS="unlimited"
STANDARD_MAX_STORAGE_MB="1000"

PREMIUM_MAX_PROFILES="20"
PREMIUM_MAX_FACILITIES="5"
PREMIUM_MAX_SESSIONS="unlimited"
PREMIUM_MAX_STORAGE_MB="5000"

# ============================================================================
# LOGGING & MONITORING
# ============================================================================
LOG_LEVEL="info"  # "debug", "info", "warn", "error"
LOG_FORMAT="json"  # "json" or "pretty"
ENABLE_CONSOLE_LOGS="true"
ENABLE_FILE_LOGS="false"
LOG_FILE_PATH="./logs/app.log"

# Optional: Sentry for error tracking
SENTRY_DSN=""
SENTRY_ENVIRONMENT="${NODE_ENV}"
SENTRY_TRACES_SAMPLE_RATE="0.1"

# Optional: DataDog, New Relic, etc.
# DD_API_KEY=""
# DD_APP_KEY=""
# NEW_RELIC_LICENSE_KEY=""

# ============================================================================
# RATE LIMITING
# ============================================================================
RATE_LIMIT_WINDOW_MS="900000"  # 15 minutes
RATE_LIMIT_MAX_REQUESTS="100"
RATE_LIMIT_AUTH_MAX_REQUESTS="5"  # Login/signup
RATE_LIMIT_UPLOAD_MAX_REQUESTS="10"  # File uploads

# ============================================================================
# FILE UPLOAD LIMITS
# ============================================================================
MAX_FILE_SIZE_MB="500"  # Maximum video file size
MAX_FILE_SIZE_BYTES="524288000"  # 500 MB in bytes
ALLOWED_VIDEO_FORMATS="mp4,avi,mov,mkv,webm"
ALLOWED_IMAGE_FORMATS="jpg,jpeg,png,webp"

# ============================================================================
# VIDEO PROCESSING CONFIGURATION
# ============================================================================
VIDEO_PROCESSING_TIMEOUT_SECONDS="300"  # 5 minutes
VIDEO_MAX_DURATION_SECONDS="3600"  # 1 hour
VIDEO_THUMBNAIL_WIDTH="320"
VIDEO_THUMBNAIL_HEIGHT="180"
VIDEO_THUMBNAIL_TIME_OFFSET="1"  # Seconds into video

# ============================================================================
# PRISMA CONFIGURATION
# ============================================================================
PRISMA_STUDIO_PORT="5555"
PRISMA_QUERY_LOG="false"  # Set to "true" to log all queries
PRISMA_ERROR_FORMAT="pretty"  # "pretty", "colorless", or "minimal"

# Migration settings:
RUN_MIGRATIONS="false"  # Set to "true" only for initial deploy

# ============================================================================
# RENDER-SPECIFIC VARIABLES
# ============================================================================
# These are automatically set by Render, DO NOT set manually:
# RENDER="true"
# RENDER_SERVICE_NAME="trackpose-backend"
# RENDER_INSTANCE_ID="srv-xxxxx"
# RENDER_GIT_COMMIT="abc123..."
# RENDER_SERVICE_ID="srv-xxxxx"
# RENDER_EXTERNAL_URL="https://trackpose-backend.onrender.com"
# RENDER_DISCOVERY_SERVICE="trackpose-backend.trackpose"

# Manual Render settings:
RENDER_DATABASE_URL="${DATABASE_URL}"  # Reference to database service

# ============================================================================
# DEVELOPMENT TOOLS
# ============================================================================
DEBUG="false"  # Enable debug mode
DEBUG_NAMESPACE="trackpose:*"  # Debug namespace filter

# TypeScript compilation:
TS_NODE_DEV="true"
TS_NODE_TRANSPILE_ONLY="true"

# Hot reload:
NODEMON_WATCH="src/**/*.ts"
NODEMON_DELAY="2000"

# ============================================================================
# TESTING
# ============================================================================
TEST_DATABASE_URL="mysql://trackpose:trackpose_password@localhost:3306/trackpose_test"
TEST_JWT_SECRET="test_jwt_secret"
TEST_MODE="false"

# ============================================================================
# MOBILE APP SPECIFIC (for reference, set in Flutter app)
# ============================================================================
# FLUTTER_API_BASE_URL="http://localhost:3000/api/v1"
# FLUTTER_STRIPE_PUBLISHABLE_KEY="${STRIPE_PUBLISHABLE_KEY}"
# FLUTTER_ENVIRONMENT="development"

# ============================================================================
# NOTES
# ============================================================================
# 
# REQUIRED VARIABLES:
# - DATABASE_URL
# - JWT_SECRET
# - STRIPE_SECRET_KEY
# - STRIPE_WEBHOOK_SECRET
# - S3_BUCKET, S3_REGION, S3_ACCESS_KEY_ID, S3_SECRET_ACCESS_KEY
# - SENDGRID_API_KEY or SMTP credentials
# - CALLBACK_SECRET
# 
# SECURITY:
# - Never commit this file with real values to version control
# - Use .env for local development
# - Use Render Dashboard or CI/CD secrets for production
# - Rotate secrets regularly
# - Use strong random values for JWT_SECRET, SESSION_SECRET, CALLBACK_SECRET
# 
# DEPLOYMENT:
# - Set all required variables in Render Dashboard before deploying
# - Ensure CALLBACK_SECRET matches between backend and media services
# - Set RUN_MIGRATIONS=true only for initial deploy
# - Use production Stripe keys (sk_live_..., pk_live_...)
# - Configure Stripe webhook URL after first deploy
# - Verify SendGrid sender domain
#